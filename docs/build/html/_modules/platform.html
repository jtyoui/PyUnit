

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>platform &mdash; jtyoui 2019.12.11 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> jtyoui
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">jtyoui</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">模块代码</a> &raquo;</li>
        
      <li>platform</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>platform 源代码</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="sd">&quot;&quot;&quot; This module tries to retrieve as much platform-identifying data as</span>
<span class="sd">    possible. It makes this information available via function APIs.</span>

<span class="sd">    If called from the command line, it prints the platform</span>
<span class="sd">    information concatenated as single string to stdout. The output</span>
<span class="sd">    format is useable as part of a filename.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#    This module is maintained by Marc-Andre Lemburg &lt;mal@egenix.com&gt;.</span>
<span class="c1">#    If you find problems, please submit bug reports/patches via the</span>
<span class="c1">#    Python bug tracker (http://bugs.python.org) and assign them to &quot;lemburg&quot;.</span>
<span class="c1">#</span>
<span class="c1">#    Still needed:</span>
<span class="c1">#    * support for MS-DOS (PythonDX ?)</span>
<span class="c1">#    * support for Amiga and other still unsupported platforms running Python</span>
<span class="c1">#    * support for additional Linux distributions</span>
<span class="c1">#</span>
<span class="c1">#    Many thanks to all those who helped adding platform-specific</span>
<span class="c1">#    checks (in no particular order):</span>
<span class="c1">#</span>
<span class="c1">#      Charles G Waldman, David Arnold, Gordon McMillan, Ben Darnell,</span>
<span class="c1">#      Jeff Bauer, Cliff Crawford, Ivan Van Laningham, Josef</span>
<span class="c1">#      Betancourt, Randall Hopper, Karl Putland, John Farrell, Greg</span>
<span class="c1">#      Andruk, Just van Rossum, Thomas Heller, Mark R. Levinson, Mark</span>
<span class="c1">#      Hammond, Bill Tutt, Hans Nowak, Uwe Zessin (OpenVMS support),</span>
<span class="c1">#      Colin Kong, Trent Mick, Guido van Rossum, Anthony Baxter, Steve</span>
<span class="c1">#      Dower</span>
<span class="c1">#</span>
<span class="c1">#    History:</span>
<span class="c1">#</span>
<span class="c1">#    &lt;see CVS and SVN checkin messages for history&gt;</span>
<span class="c1">#</span>
<span class="c1">#    1.0.8 - changed Windows support to read version from kernel32.dll</span>
<span class="c1">#    1.0.7 - added DEV_NULL</span>
<span class="c1">#    1.0.6 - added linux_distribution()</span>
<span class="c1">#    1.0.5 - fixed Java support to allow running the module on Jython</span>
<span class="c1">#    1.0.4 - added IronPython support</span>
<span class="c1">#    1.0.3 - added normalization of Windows system name</span>
<span class="c1">#    1.0.2 - added more Windows support</span>
<span class="c1">#    1.0.1 - reformatted to make doc.py happy</span>
<span class="c1">#    1.0.0 - reformatted a bit and checked into Python CVS</span>
<span class="c1">#    0.8.0 - added sys.version parser and various new access</span>
<span class="c1">#            APIs (python_version(), python_compiler(), etc.)</span>
<span class="c1">#    0.7.2 - fixed architecture() to use sizeof(pointer) where available</span>
<span class="c1">#    0.7.1 - added support for Caldera OpenLinux</span>
<span class="c1">#    0.7.0 - some fixes for WinCE; untabified the source file</span>
<span class="c1">#    0.6.2 - support for OpenVMS - requires version 1.5.2-V006 or higher and</span>
<span class="c1">#            vms_lib.getsyi() configured</span>
<span class="c1">#    0.6.1 - added code to prevent &#39;uname -p&#39; on platforms which are</span>
<span class="c1">#            known not to support it</span>
<span class="c1">#    0.6.0 - fixed win32_ver() to hopefully work on Win95,98,NT and Win2k;</span>
<span class="c1">#            did some cleanup of the interfaces - some APIs have changed</span>
<span class="c1">#    0.5.5 - fixed another type in the MacOS code... should have</span>
<span class="c1">#            used more coffee today ;-)</span>
<span class="c1">#    0.5.4 - fixed a few typos in the MacOS code</span>
<span class="c1">#    0.5.3 - added experimental MacOS support; added better popen()</span>
<span class="c1">#            workarounds in _syscmd_ver() -- still not 100% elegant</span>
<span class="c1">#            though</span>
<span class="c1">#    0.5.2 - fixed uname() to return &#39;&#39; instead of &#39;unknown&#39; in all</span>
<span class="c1">#            return values (the system uname command tends to return</span>
<span class="c1">#            &#39;unknown&#39; instead of just leaving the field empty)</span>
<span class="c1">#    0.5.1 - included code for slackware dist; added exception handlers</span>
<span class="c1">#            to cover up situations where platforms don&#39;t have os.popen</span>
<span class="c1">#            (e.g. Mac) or fail on socket.gethostname(); fixed libc</span>
<span class="c1">#            detection RE</span>
<span class="c1">#    0.5.0 - changed the API names referring to system commands to *syscmd*;</span>
<span class="c1">#            added java_ver(); made syscmd_ver() a private</span>
<span class="c1">#            API (was system_ver() in previous versions) -- use uname()</span>
<span class="c1">#            instead; extended the win32_ver() to also return processor</span>
<span class="c1">#            type information</span>
<span class="c1">#    0.4.0 - added win32_ver() and modified the platform() output for WinXX</span>
<span class="c1">#    0.3.4 - fixed a bug in _follow_symlinks()</span>
<span class="c1">#    0.3.3 - fixed popen() and &quot;file&quot; command invocation bugs</span>
<span class="c1">#    0.3.2 - added architecture() API and support for it in platform()</span>
<span class="c1">#    0.3.1 - fixed syscmd_ver() RE to support Windows NT</span>
<span class="c1">#    0.3.0 - added system alias support</span>
<span class="c1">#    0.2.3 - removed &#39;wince&#39; again... oh well.</span>
<span class="c1">#    0.2.2 - added &#39;wince&#39; to syscmd_ver() supported platforms</span>
<span class="c1">#    0.2.1 - added cache logic and changed the platform string format</span>
<span class="c1">#    0.2.0 - changed the API to use functions instead of module globals</span>
<span class="c1">#            since some action take too long to be run on module import</span>
<span class="c1">#    0.1.0 - first release</span>
<span class="c1">#</span>
<span class="c1">#    You can always get the latest version of this module at:</span>
<span class="c1">#</span>
<span class="c1">#             http://www.egenix.com/files/python/platform.py</span>
<span class="c1">#</span>
<span class="c1">#    If that URL should fail, try contacting the author.</span>

<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Copyright (c) 1999-2000, Marc-Andre Lemburg; mailto:mal@lemburg.com</span>
<span class="s2">    Copyright (c) 2000-2010, eGenix.com Software GmbH; mailto:info@egenix.com</span>

<span class="s2">    Permission to use, copy, modify, and distribute this software and its</span>
<span class="s2">    documentation for any purpose and without fee or royalty is hereby granted,</span>
<span class="s2">    provided that the above copyright notice appear in all copies and that</span>
<span class="s2">    both that copyright notice and this permission notice appear in</span>
<span class="s2">    supporting documentation or portions thereof, including modifications,</span>
<span class="s2">    that you make.</span>

<span class="s2">    EGENIX.COM SOFTWARE GMBH DISCLAIMS ALL WARRANTIES WITH REGARD TO</span>
<span class="s2">    THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND</span>
<span class="s2">    FITNESS, IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL,</span>
<span class="s2">    INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING</span>
<span class="s2">    FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,</span>
<span class="s2">    NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION</span>
<span class="s2">    WITH THE USE OR PERFORMANCE OF THIS SOFTWARE !</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;1.0.8&#39;</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">subprocess</span>

<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1">### Globals &amp; Constants</span>

<span class="c1"># Determine the platform&#39;s /dev/null device</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">DEV_NULL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">devnull</span>
<span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
    <span class="c1"># os.devnull was added in Python 2.4, so emulate it for earlier</span>
    <span class="c1"># Python versions</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;dos&#39;</span><span class="p">,</span> <span class="s1">&#39;win32&#39;</span><span class="p">,</span> <span class="s1">&#39;win16&#39;</span><span class="p">):</span>
        <span class="c1"># Use the old CP/M NUL as device name</span>
        <span class="n">DEV_NULL</span> <span class="o">=</span> <span class="s1">&#39;NUL&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Standard Unix uses /dev/null</span>
        <span class="n">DEV_NULL</span> <span class="o">=</span> <span class="s1">&#39;/dev/null&#39;</span>

<span class="c1"># Directory to search for configuration information on Unix.</span>
<span class="c1"># Constant used by test_platform to test linux_distribution().</span>
<span class="n">_UNIXCONFDIR</span> <span class="o">=</span> <span class="s1">&#39;/etc&#39;</span>

<span class="c1"># Helper for comparing two version number strings.</span>
<span class="c1"># Based on the description of the PHP&#39;s version_compare():</span>
<span class="c1"># http://php.net/manual/en/function.version-compare.php</span>

<span class="n">_ver_stages</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># any string not found in this dict, will get 0 assigned</span>
    <span class="s1">&#39;dev&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
    <span class="s1">&#39;RC&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;rc&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="c1"># number, will get 100 assigned</span>
    <span class="s1">&#39;pl&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">_component_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([0-9]+|[._+-])&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_comparable_version</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_component_re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;._+-&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">_ver_stages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1">### Platform specific APIs</span>

<span class="n">_libc_search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;(__libc_init)&#39;</span>
                          <span class="sa">b</span><span class="s1">&#39;|&#39;</span>
                          <span class="sa">b</span><span class="s1">&#39;(GLIBC_([0-9.]+))&#39;</span>
                          <span class="sa">b</span><span class="s1">&#39;|&#39;</span>
                          <span class="sa">br</span><span class="s1">&#39;(libc(_\w+)?\.so(?:\.(\d[0-9.]*))?)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">libc_ver</span><span class="p">(</span><span class="n">executable</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">lib</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">16384</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Tries to determine the libc version that the file executable</span>
<span class="sd">        (which defaults to the Python interpreter) is linked against.</span>

<span class="sd">        Returns a tuple of strings (lib,version) which default to the</span>
<span class="sd">        given parameters in case the lookup fails.</span>

<span class="sd">        Note that the function has intimate knowledge of how different</span>
<span class="sd">        libc versions add symbols to the executable and thus is probably</span>
<span class="sd">        only useable for executables compiled using gcc.</span>

<span class="sd">        The file is read and scanned in chunks of chunksize bytes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">_comparable_version</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;realpath&#39;</span><span class="p">):</span>
        <span class="c1"># Python 2.2 introduced os.path.realpath(); it is used</span>
        <span class="c1"># here to work around problems with Cygwin not being</span>
        <span class="c1"># able to open symlinks for reading</span>
        <span class="n">executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">executable</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">binary</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">binary</span><span class="p">):</span>
            <span class="k">if</span> <span class="sa">b</span><span class="s1">&#39;libc&#39;</span> <span class="ow">in</span> <span class="n">binary</span> <span class="ow">or</span> <span class="sa">b</span><span class="s1">&#39;GLIBC&#39;</span> <span class="ow">in</span> <span class="n">binary</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">_libc_search</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span> <span class="ow">or</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">binary</span><span class="p">):</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunksize</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
                    <span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1000</span><span class="p">):]</span> <span class="o">+</span> <span class="n">chunk</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">libcinit</span><span class="p">,</span> <span class="n">glibc</span><span class="p">,</span> <span class="n">glibcversion</span><span class="p">,</span> <span class="n">so</span><span class="p">,</span> <span class="n">threads</span><span class="p">,</span> <span class="n">soversion</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">s</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">libcinit</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">lib</span><span class="p">:</span>
                <span class="n">lib</span> <span class="o">=</span> <span class="s1">&#39;libc&#39;</span>
            <span class="k">elif</span> <span class="n">glibc</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lib</span> <span class="o">!=</span> <span class="s1">&#39;glibc&#39;</span><span class="p">:</span>
                    <span class="n">lib</span> <span class="o">=</span> <span class="s1">&#39;glibc&#39;</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="n">glibcversion</span>
                <span class="k">elif</span> <span class="n">V</span><span class="p">(</span><span class="n">glibcversion</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">V</span><span class="p">(</span><span class="n">version</span><span class="p">):</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="n">glibcversion</span>
            <span class="k">elif</span> <span class="n">so</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lib</span> <span class="o">!=</span> <span class="s1">&#39;glibc&#39;</span><span class="p">:</span>
                    <span class="n">lib</span> <span class="o">=</span> <span class="s1">&#39;libc&#39;</span>
                    <span class="k">if</span> <span class="n">soversion</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">version</span> <span class="ow">or</span> <span class="n">V</span><span class="p">(</span><span class="n">soversion</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">V</span><span class="p">(</span><span class="n">version</span><span class="p">)):</span>
                        <span class="n">version</span> <span class="o">=</span> <span class="n">soversion</span>
                    <span class="k">if</span> <span class="n">threads</span> <span class="ow">and</span> <span class="n">version</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">threads</span><span class="p">):]</span> <span class="o">!=</span> <span class="n">threads</span><span class="p">:</span>
                        <span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="o">+</span> <span class="n">threads</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">lib</span><span class="p">,</span> <span class="n">version</span>

<span class="k">def</span> <span class="nf">_dist_try_harder</span><span class="p">(</span><span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Tries some special tricks to get the distribution</span>
<span class="sd">        information in case the default method fails.</span>

<span class="sd">        Currently supports older SuSE Linux, Caldera OpenLinux and</span>
<span class="sd">        Slackware Linux distributions.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/var/adm/inst-log/info&#39;</span><span class="p">):</span>
        <span class="c1"># SuSE Linux stores distribution information in that file</span>
        <span class="n">distname</span> <span class="o">=</span> <span class="s1">&#39;SuSE&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/var/adm/inst-log/info&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">tv</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">tag</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">tv</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;MIN_DIST_VERSION&#39;</span><span class="p">:</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;DIST_IDENT&#39;</span><span class="p">:</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;/etc/.installed&#39;</span><span class="p">):</span>
        <span class="c1"># Caldera OpenLinux has some infos in that file (thanks to Colin Kong)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/etc/.installed&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pkg</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pkg</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">pkg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;OpenLinux&#39;</span><span class="p">:</span>
                    <span class="c1"># XXX does Caldera support non Intel platforms ? If yes,</span>
                    <span class="c1">#     where can we find the needed id ?</span>
                    <span class="k">return</span> <span class="s1">&#39;OpenLinux&#39;</span><span class="p">,</span> <span class="n">pkg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">id</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;/usr/lib/setup&#39;</span><span class="p">):</span>
        <span class="c1"># Check for slackware version tag file (thanks to Greg Andruk)</span>
        <span class="n">verfiles</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/usr/lib/setup&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">verfiles</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verfiles</span><span class="p">[</span><span class="n">n</span><span class="p">][:</span><span class="mi">14</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;slack-version-&#39;</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">verfiles</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">verfiles</span><span class="p">:</span>
            <span class="n">verfiles</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="n">distname</span> <span class="o">=</span> <span class="s1">&#39;slackware&#39;</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">verfiles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">14</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>

    <span class="k">return</span> <span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>

<span class="n">_release_filename</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\w+)[-_](release|version)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>
<span class="n">_lsb_release_version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(.+)&#39;</span>
                                  <span class="sa">r</span><span class="s1">&#39; release &#39;</span>
                                  <span class="sa">r</span><span class="s1">&#39;([\d.]+)&#39;</span>
                                  <span class="sa">r</span><span class="s1">&#39;[^(]*(?:\((.+)\))?&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>
<span class="n">_release_version</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([^0-9]+)&#39;</span>
                              <span class="sa">r</span><span class="s1">&#39;(?: release )?&#39;</span>
                              <span class="sa">r</span><span class="s1">&#39;([\d.]+)&#39;</span>
                              <span class="sa">r</span><span class="s1">&#39;[^(]*(?:\((.+)\))?&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>

<span class="c1"># See also http://www.novell.com/coolsolutions/feature/11251.html</span>
<span class="c1"># and http://linuxmafia.com/faq/Admin/release-files.html</span>
<span class="c1"># and http://data.linux-ntfs.org/rpm/whichrpm</span>
<span class="c1"># and http://www.die.net/doc/linux/man/man1/lsb_release.1.html</span>

<span class="n">_supported_dists</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;SuSE&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span><span class="p">,</span> <span class="s1">&#39;fedora&#39;</span><span class="p">,</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mandrake&#39;</span><span class="p">,</span> <span class="s1">&#39;mandriva&#39;</span><span class="p">,</span> <span class="s1">&#39;rocks&#39;</span><span class="p">,</span> <span class="s1">&#39;slackware&#39;</span><span class="p">,</span> <span class="s1">&#39;yellowdog&#39;</span><span class="p">,</span> <span class="s1">&#39;gentoo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;UnitedLinux&#39;</span><span class="p">,</span> <span class="s1">&#39;turbolinux&#39;</span><span class="p">,</span> <span class="s1">&#39;arch&#39;</span><span class="p">,</span> <span class="s1">&#39;mageia&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_parse_release_file</span><span class="p">(</span><span class="n">firstline</span><span class="p">):</span>

    <span class="c1"># Default to empty &#39;version&#39; and &#39;id&#39; strings.  Both defaults are used</span>
    <span class="c1"># when &#39;firstline&#39; is empty.  &#39;id&#39; defaults to empty when an id can not</span>
    <span class="c1"># be deduced.</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Parse the first line</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_lsb_release_version</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">firstline</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># LSB format: &quot;distro release x.x (codename)&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>

    <span class="c1"># Pre-LSB format: &quot;distro x.x (codename)&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_release_version</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">firstline</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>

    <span class="c1"># Unknown format... take the first two words</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">firstline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>

<span class="k">def</span> <span class="nf">linux_distribution</span><span class="p">(</span><span class="n">distname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>

                       <span class="n">supported_dists</span><span class="o">=</span><span class="n">_supported_dists</span><span class="p">,</span>
                       <span class="n">full_distribution_name</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;dist() and linux_distribution() functions are deprecated &quot;</span>
                  <span class="s2">&quot;in Python 3.5&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_linux_distribution</span><span class="p">(</span><span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">supported_dists</span><span class="p">,</span>
                               <span class="n">full_distribution_name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_linux_distribution</span><span class="p">(</span><span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">supported_dists</span><span class="p">,</span>
                        <span class="n">full_distribution_name</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Tries to determine the name of the Linux OS distribution name.</span>

<span class="sd">        The function first looks for a distribution release file in</span>
<span class="sd">        /etc and then reverts to _dist_try_harder() in case no</span>
<span class="sd">        suitable files are found.</span>

<span class="sd">        supported_dists may be given to define the set of Linux</span>
<span class="sd">        distributions to look for. It defaults to a list of currently</span>
<span class="sd">        supported Linux distributions identified by their release file</span>
<span class="sd">        name.</span>

<span class="sd">        If full_distribution_name is true (default), the full</span>
<span class="sd">        distribution read from the OS is returned. Otherwise the short</span>
<span class="sd">        name taken from supported_dists is used.</span>

<span class="sd">        Returns a tuple (distname, version, id) which default to the</span>
<span class="sd">        args given as parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">etc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">_UNIXCONFDIR</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="c1"># Probably not a Unix system</span>
        <span class="k">return</span> <span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>
    <span class="n">etc</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">etc</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">_release_filename</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_distname</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">_distname</span> <span class="ow">in</span> <span class="n">supported_dists</span><span class="p">:</span>
                <span class="n">distname</span> <span class="o">=</span> <span class="n">_distname</span>
                <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_dist_try_harder</span><span class="p">(</span><span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

    <span class="c1"># Read the first line</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_UNIXCONFDIR</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
              <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;surrogateescape&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">firstline</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">_distname</span><span class="p">,</span> <span class="n">_version</span><span class="p">,</span> <span class="n">_id</span> <span class="o">=</span> <span class="n">_parse_release_file</span><span class="p">(</span><span class="n">firstline</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_distname</span> <span class="ow">and</span> <span class="n">full_distribution_name</span><span class="p">:</span>
        <span class="n">distname</span> <span class="o">=</span> <span class="n">_distname</span>
    <span class="k">if</span> <span class="n">_version</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">_version</span>
    <span class="k">if</span> <span class="n">_id</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">_id</span>
    <span class="k">return</span> <span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span>

<span class="c1"># To maintain backwards compatibility:</span>

<span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">distname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>

         <span class="n">supported_dists</span><span class="o">=</span><span class="n">_supported_dists</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Tries to determine the name of the Linux OS distribution name.</span>

<span class="sd">        The function first looks for a distribution release file in</span>
<span class="sd">        /etc and then reverts to _dist_try_harder() in case no</span>
<span class="sd">        suitable files are found.</span>

<span class="sd">        Returns a tuple (distname, version, id) which default to the</span>
<span class="sd">        args given as parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;dist() and linux_distribution() functions are deprecated &quot;</span>
                  <span class="s2">&quot;in Python 3.5&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_linux_distribution</span><span class="p">(</span><span class="n">distname</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span>
                               <span class="n">supported_dists</span><span class="o">=</span><span class="n">supported_dists</span><span class="p">,</span>
                               <span class="n">full_distribution_name</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Portable popen() interface.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;use os.popen instead&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">bufsize</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_version</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Normalize the version and build strings and return a single</span>
<span class="sd">        version string using the format major.minor.build (or patchlevel).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">build</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">build</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ints</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="n">l</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ints</span><span class="p">))</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">version</span>

<span class="n">_ver_output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?:([\w ]+) ([\w.]+) &#39;</span>
                         <span class="sa">r</span><span class="s1">&#39;.*&#39;</span>
                         <span class="sa">r</span><span class="s1">&#39;\[.* ([\d.]+)\])&#39;</span><span class="p">)</span>

<span class="c1"># Examples of VER command output:</span>
<span class="c1">#</span>
<span class="c1">#   Windows 2000:  Microsoft Windows 2000 [Version 5.00.2195]</span>
<span class="c1">#   Windows XP:    Microsoft Windows XP [Version 5.1.2600]</span>
<span class="c1">#   Windows Vista: Microsoft Windows [Version 6.0.6002]</span>
<span class="c1">#</span>
<span class="c1"># Note that the &quot;Version&quot; string gets localized on different</span>
<span class="c1"># Windows versions.</span>

<span class="k">def</span> <span class="nf">_syscmd_ver</span><span class="p">(</span><span class="n">system</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">release</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>

               <span class="n">supported_platforms</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;win32&#39;</span><span class="p">,</span> <span class="s1">&#39;win16&#39;</span><span class="p">,</span> <span class="s1">&#39;dos&#39;</span><span class="p">)):</span>

    <span class="sd">&quot;&quot;&quot; Tries to figure out the OS version used and returns</span>
<span class="sd">        a tuple (system, release, version).</span>

<span class="sd">        It uses the &quot;ver&quot; shell command for this which is known</span>
<span class="sd">        to exists on Windows, DOS. XXX Others too ?</span>

<span class="sd">        In case this fails, the given parameters are used as</span>
<span class="sd">        defaults.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_platforms</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span>

    <span class="c1"># Try some common cmd strings</span>
    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ver&#39;</span><span class="p">,</span> <span class="s1">&#39;command /c ver&#39;</span><span class="p">,</span> <span class="s1">&#39;cmd /c ver&#39;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pipe</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">pipe</span><span class="o">.</span><span class="n">close</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s1">&#39;command failed&#39;</span><span class="p">)</span>
            <span class="c1"># XXX How can I suppress shell errors from being written</span>
            <span class="c1">#     to stderr ?</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">why</span><span class="p">:</span>
            <span class="c1">#print &#39;Command %s failed: %s&#39; % (cmd, why)</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span>

    <span class="c1"># Parse the output</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">_ver_output</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="c1"># Strip trailing dots from version and release</span>
        <span class="k">if</span> <span class="n">release</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">release</span> <span class="o">=</span> <span class="n">release</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">version</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">version</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Normalize the version and build strings (eliminating additional</span>
        <span class="c1"># zeros)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">_norm_version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span>

<span class="n">_WIN32_CLIENT_RELEASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="s2">&quot;2000&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="s2">&quot;XP&quot;</span><span class="p">,</span>
    <span class="c1"># Strictly, 5.2 client is XP 64-bit, but platform.py historically</span>
    <span class="c1"># has always called it 2003 Server</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="s2">&quot;2003Server&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="s2">&quot;post2003&quot;</span><span class="p">,</span>

    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="s2">&quot;Vista&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="s2">&quot;8.1&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="s2">&quot;post8.1&quot;</span><span class="p">,</span>

    <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="s2">&quot;post10&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Server release name lookup will default to client names if necessary</span>
<span class="n">_WIN32_SERVER_RELEASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="s2">&quot;2003Server&quot;</span><span class="p">,</span>

    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="s2">&quot;2008Server&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="s2">&quot;2008ServerR2&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="s2">&quot;2012Server&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="s2">&quot;2012ServerR2&quot;</span><span class="p">,</span>
    <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span> <span class="s2">&quot;post2012ServerR2&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">win32_ver</span><span class="p">(</span><span class="n">release</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">csd</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">sys</span> <span class="k">import</span> <span class="n">getwindowsversion</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">ptype</span>

    <span class="n">winver</span> <span class="o">=</span> <span class="n">getwindowsversion</span><span class="p">()</span>
    <span class="n">maj</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">build</span> <span class="o">=</span> <span class="n">winver</span><span class="o">.</span><span class="n">platform_version</span> <span class="ow">or</span> <span class="n">winver</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">.</span><span class="si">{1}</span><span class="s1">.</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maj</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">build</span><span class="p">)</span>

    <span class="n">release</span> <span class="o">=</span> <span class="p">(</span><span class="n">_WIN32_CLIENT_RELEASES</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">maj</span><span class="p">,</span> <span class="nb">min</span><span class="p">))</span> <span class="ow">or</span>
               <span class="n">_WIN32_CLIENT_RELEASES</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">maj</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span>
               <span class="n">release</span><span class="p">)</span>

    <span class="c1"># getwindowsversion() reflect the compatibility mode Python is</span>
    <span class="c1"># running under, and so the service pack value is only going to be</span>
    <span class="c1"># valid if the versions match.</span>
    <span class="k">if</span> <span class="n">winver</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">maj</span><span class="p">,</span> <span class="nb">min</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">csd</span> <span class="o">=</span> <span class="s1">&#39;SP</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">winver</span><span class="o">.</span><span class="n">service_pack_major</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">csd</span><span class="p">[:</span><span class="mi">13</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Service Pack &#39;</span><span class="p">:</span>
                <span class="n">csd</span> <span class="o">=</span> <span class="s1">&#39;SP&#39;</span> <span class="o">+</span> <span class="n">csd</span><span class="p">[</span><span class="mi">13</span><span class="p">:]</span>

    <span class="c1"># VER_NT_SERVER = 3</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">winver</span><span class="p">,</span> <span class="s1">&#39;product_type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">release</span> <span class="o">=</span> <span class="p">(</span><span class="n">_WIN32_SERVER_RELEASES</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">maj</span><span class="p">,</span> <span class="nb">min</span><span class="p">))</span> <span class="ow">or</span>
                   <span class="n">_WIN32_SERVER_RELEASES</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">maj</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span>
                   <span class="n">release</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">winreg</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">_winreg</span> <span class="k">as</span> <span class="nn">winreg</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cvkey</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;SOFTWARE\Microsoft\Windows NT\CurrentVersion&#39;</span>
            <span class="k">with</span> <span class="n">winreg</span><span class="o">.</span><span class="n">OpenKeyEx</span><span class="p">(</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="n">cvkey</span><span class="p">)</span> <span class="k">as</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">ptype</span> <span class="o">=</span> <span class="n">QueryValueEx</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;CurrentType&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">ptype</span>


<span class="k">def</span> <span class="nf">_mac_ver_xml</span><span class="p">():</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;/System/Library/CoreServices/SystemVersion.plist&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">plistlib</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="n">plistlib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">release</span> <span class="o">=</span> <span class="n">pl</span><span class="p">[</span><span class="s1">&#39;ProductVersion&#39;</span><span class="p">]</span>
    <span class="n">versioninfo</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">machine</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">machine</span>
    <span class="k">if</span> <span class="n">machine</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ppc&#39;</span><span class="p">,</span> <span class="s1">&#39;Power Macintosh&#39;</span><span class="p">):</span>
        <span class="c1"># Canonical name</span>
        <span class="n">machine</span> <span class="o">=</span> <span class="s1">&#39;PowerPC&#39;</span>

    <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">versioninfo</span><span class="p">,</span> <span class="n">machine</span>


<span class="k">def</span> <span class="nf">mac_ver</span><span class="p">(</span><span class="n">release</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">versioninfo</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">machine</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Get MacOS version information and return it as tuple (release,</span>
<span class="sd">        versioninfo, machine) with versioninfo being a tuple (version,</span>
<span class="sd">        dev_stage, non_release_version).</span>

<span class="sd">        Entries which cannot be determined are set to the parameter values</span>
<span class="sd">        which default to &#39;&#39;. All tuple entries are strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># First try reading the information from an XML file which should</span>
    <span class="c1"># always be present</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">_mac_ver_xml</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">info</span>

    <span class="c1"># If that also doesn&#39;t work return the default values</span>
    <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">versioninfo</span><span class="p">,</span> <span class="n">machine</span>

<span class="k">def</span> <span class="nf">_java_getprop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>

    <span class="kn">from</span> <span class="nn">java.lang</span> <span class="k">import</span> <span class="n">System</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>

<span class="k">def</span> <span class="nf">java_ver</span><span class="p">(</span><span class="n">release</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vendor</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">vminfo</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">osinfo</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>

    <span class="sd">&quot;&quot;&quot; Version interface for Jython.</span>

<span class="sd">        Returns a tuple (release, vendor, vminfo, osinfo) with vminfo being</span>
<span class="sd">        a tuple (vm_name, vm_release, vm_vendor) and osinfo being a</span>
<span class="sd">        tuple (os_name, os_version, os_arch).</span>

<span class="sd">        Values which cannot be determined are set to the defaults</span>
<span class="sd">        given as parameters (which all default to &#39;&#39;).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Import the needed APIs</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">java.lang</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">vendor</span><span class="p">,</span> <span class="n">vminfo</span><span class="p">,</span> <span class="n">osinfo</span>

    <span class="n">vendor</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s1">&#39;java.vendor&#39;</span><span class="p">,</span> <span class="n">vendor</span><span class="p">)</span>
    <span class="n">release</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s1">&#39;java.version&#39;</span><span class="p">,</span> <span class="n">release</span><span class="p">)</span>
    <span class="n">vm_name</span><span class="p">,</span> <span class="n">vm_release</span><span class="p">,</span> <span class="n">vm_vendor</span> <span class="o">=</span> <span class="n">vminfo</span>
    <span class="n">vm_name</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s1">&#39;java.vm.name&#39;</span><span class="p">,</span> <span class="n">vm_name</span><span class="p">)</span>
    <span class="n">vm_vendor</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s1">&#39;java.vm.vendor&#39;</span><span class="p">,</span> <span class="n">vm_vendor</span><span class="p">)</span>
    <span class="n">vm_release</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s1">&#39;java.vm.version&#39;</span><span class="p">,</span> <span class="n">vm_release</span><span class="p">)</span>
    <span class="n">vminfo</span> <span class="o">=</span> <span class="n">vm_name</span><span class="p">,</span> <span class="n">vm_release</span><span class="p">,</span> <span class="n">vm_vendor</span>
    <span class="n">os_name</span><span class="p">,</span> <span class="n">os_version</span><span class="p">,</span> <span class="n">os_arch</span> <span class="o">=</span> <span class="n">osinfo</span>
    <span class="n">os_arch</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s1">&#39;java.os.arch&#39;</span><span class="p">,</span> <span class="n">os_arch</span><span class="p">)</span>
    <span class="n">os_name</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s1">&#39;java.os.name&#39;</span><span class="p">,</span> <span class="n">os_name</span><span class="p">)</span>
    <span class="n">os_version</span> <span class="o">=</span> <span class="n">_java_getprop</span><span class="p">(</span><span class="s1">&#39;java.os.version&#39;</span><span class="p">,</span> <span class="n">os_version</span><span class="p">)</span>
    <span class="n">osinfo</span> <span class="o">=</span> <span class="n">os_name</span><span class="p">,</span> <span class="n">os_version</span><span class="p">,</span> <span class="n">os_arch</span>

    <span class="k">return</span> <span class="n">release</span><span class="p">,</span> <span class="n">vendor</span><span class="p">,</span> <span class="n">vminfo</span><span class="p">,</span> <span class="n">osinfo</span>

<span class="c1">### System name aliasing</span>

<span class="k">def</span> <span class="nf">system_alias</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Returns (system, release, version) aliased to common</span>
<span class="sd">        marketing names used for some systems.</span>

<span class="sd">        It also does some reordering of the information in some cases</span>
<span class="sd">        where it would otherwise cause confusion.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Rhapsody&#39;</span><span class="p">:</span>
        <span class="c1"># Apple&#39;s BSD derivative</span>
        <span class="c1"># XXX How can we determine the marketing release number ?</span>
        <span class="k">return</span> <span class="s1">&#39;MacOS X Server&#39;</span><span class="p">,</span> <span class="n">system</span><span class="o">+</span><span class="n">release</span><span class="p">,</span> <span class="n">version</span>

    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;SunOS&#39;</span><span class="p">:</span>
        <span class="c1"># Sun&#39;s OS</span>
        <span class="k">if</span> <span class="n">release</span> <span class="o">&lt;</span> <span class="s1">&#39;5&#39;</span><span class="p">:</span>
            <span class="c1"># These releases use the old name SunOS</span>
            <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span>
        <span class="c1"># Modify release (marketing release = SunOS release - 3)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">release</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">major</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">major</span> <span class="o">=</span> <span class="n">major</span> <span class="o">-</span> <span class="mi">3</span>
                <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">major</span><span class="p">)</span>
                <span class="n">release</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">release</span> <span class="o">&lt;</span> <span class="s1">&#39;6&#39;</span><span class="p">:</span>
            <span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;Solaris&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># XXX Whatever the new SunOS marketing name is...</span>
            <span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;Solaris&#39;</span>

    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;IRIX64&#39;</span><span class="p">:</span>
        <span class="c1"># IRIX reports IRIX64 on platforms with 64-bit support; yet it</span>
        <span class="c1"># is really a version and not a different platform, since 32-bit</span>
        <span class="c1"># apps are also supported..</span>
        <span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;IRIX&#39;</span>
        <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="o">+</span> <span class="s1">&#39; (64bit)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;64bit&#39;</span>

    <span class="k">elif</span> <span class="n">system</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;win32&#39;</span><span class="p">,</span> <span class="s1">&#39;win16&#39;</span><span class="p">):</span>
        <span class="c1"># In case one of the other tricks</span>
        <span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;Windows&#39;</span>

    <span class="k">return</span> <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span>

<span class="c1">### Various internal helpers</span>

<span class="k">def</span> <span class="nf">_platform</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Helper to format the platform string in a filename</span>
<span class="sd">        compatible format e.g. &quot;system-version-machine&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Format the platform string</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>

    <span class="c1"># Cleanup some possible filename obstacles...</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>

    <span class="c1"># No need to report &#39;unknown&#39; information...</span>
    <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># Fold &#39;--&#39;s and remove trailing &#39;-&#39;</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cleaned</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cleaned</span> <span class="o">==</span> <span class="n">platform</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">platform</span> <span class="o">=</span> <span class="n">cleaned</span>
    <span class="k">while</span> <span class="n">platform</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
        <span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">platform</span>

<span class="k">def</span> <span class="nf">_node</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Helper to determine the node name of this machine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">socket</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c1"># No sockets...</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="c1"># Still not working...</span>
        <span class="k">return</span> <span class="n">default</span>

<span class="k">def</span> <span class="nf">_follow_symlinks</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; In case filepath is a symlink, follow it until a</span>
<span class="sd">        real file is reached.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">islink</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">readlink</span><span class="p">(</span><span class="n">filepath</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">filepath</span>

<span class="k">def</span> <span class="nf">_syscmd_uname</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Interface to the system&#39;s uname command.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;dos&#39;</span><span class="p">,</span> <span class="s1">&#39;win32&#39;</span><span class="p">,</span> <span class="s1">&#39;win16&#39;</span><span class="p">):</span>
        <span class="c1"># XXX Others too ?</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">&#39;uname </span><span class="si">%s</span><span class="s1"> 2&gt; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">DEV_NULL</span><span class="p">))</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span> <span class="ow">or</span> <span class="n">rc</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span>

<span class="k">def</span> <span class="nf">_syscmd_file</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Interface to the system&#39;s file command.</span>

<span class="sd">        The function uses the -b option of the file command to have it</span>
<span class="sd">        omit the filename in its output. Follow the symlinks. It returns</span>
<span class="sd">        default in case the command should fail.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;dos&#39;</span><span class="p">,</span> <span class="s1">&#39;win32&#39;</span><span class="p">,</span> <span class="s1">&#39;win16&#39;</span><span class="p">):</span>
        <span class="c1"># XXX Others too ?</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">_follow_symlinks</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="n">target</span><span class="p">],</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">)</span>

    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">output</span> <span class="ow">or</span> <span class="n">rc</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span>

<span class="c1">### Information about the used architecture</span>

<span class="c1"># Default values for architecture; non-empty strings override the</span>
<span class="c1"># defaults given as parameters</span>
<span class="n">_default_architecture</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;win32&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;WindowsPE&#39;</span><span class="p">),</span>
    <span class="s1">&#39;win16&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Windows&#39;</span><span class="p">),</span>
    <span class="s1">&#39;dos&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;MSDOS&#39;</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">architecture</span><span class="p">(</span><span class="n">executable</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="n">bits</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">linkage</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Queries the given executable (defaults to the Python interpreter</span>
<span class="sd">        binary) for various architecture information.</span>

<span class="sd">        Returns a tuple (bits, linkage) which contains information about</span>
<span class="sd">        the bit architecture and the linkage format used for the</span>
<span class="sd">        executable. Both values are returned as strings.</span>

<span class="sd">        Values that cannot be determined are returned as given by the</span>
<span class="sd">        parameter presets. If bits is given as &#39;&#39;, the sizeof(pointer)</span>
<span class="sd">        (or sizeof(long) on Python version &lt; 1.5.2) is used as</span>
<span class="sd">        indicator for the supported pointer size.</span>

<span class="sd">        The function relies on the system&#39;s &quot;file&quot; command to do the</span>
<span class="sd">        actual work. This is available on most if not all Unix</span>
<span class="sd">        platforms. On some non-Unix platforms where the &quot;file&quot; command</span>
<span class="sd">        does not exist and the executable is set to the Python interpreter</span>
<span class="sd">        binary defaults from _default_architecture are used.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Use the sizeof(pointer) as default number of bits if nothing</span>
    <span class="c1"># else is given as default.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">bits</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">struct</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">struct</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="c1"># Older installations can only query longs</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;bit&#39;</span>

    <span class="c1"># Get data from the &#39;file&#39; system command</span>
    <span class="k">if</span> <span class="n">executable</span><span class="p">:</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">_syscmd_file</span><span class="p">(</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">fileout</span> <span class="ow">and</span> \
       <span class="n">executable</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">:</span>
        <span class="c1"># &quot;file&quot; command did not return anything; we&#39;ll try to provide</span>
        <span class="c1"># some sensible defaults then...</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">in</span> <span class="n">_default_architecture</span><span class="p">:</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">_default_architecture</span><span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">bits</span> <span class="o">=</span> <span class="n">b</span>
            <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
                <span class="n">linkage</span> <span class="o">=</span> <span class="n">l</span>
        <span class="k">return</span> <span class="n">bits</span><span class="p">,</span> <span class="n">linkage</span>

    <span class="k">if</span> <span class="s1">&#39;executable&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="c1"># Format not supported</span>
        <span class="k">return</span> <span class="n">bits</span><span class="p">,</span> <span class="n">linkage</span>

    <span class="c1"># Bits</span>
    <span class="k">if</span> <span class="s1">&#39;32-bit&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="s1">&#39;32bit&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;N32&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="c1"># On Irix only</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="s1">&#39;n32bit&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;64-bit&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="s1">&#39;64bit&#39;</span>

    <span class="c1"># Linkage</span>
    <span class="k">if</span> <span class="s1">&#39;ELF&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="n">linkage</span> <span class="o">=</span> <span class="s1">&#39;ELF&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;PE&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="c1"># E.g. Windows uses this format</span>
        <span class="k">if</span> <span class="s1">&#39;Windows&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
            <span class="n">linkage</span> <span class="o">=</span> <span class="s1">&#39;WindowsPE&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">linkage</span> <span class="o">=</span> <span class="s1">&#39;PE&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;COFF&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="n">linkage</span> <span class="o">=</span> <span class="s1">&#39;COFF&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;MS-DOS&#39;</span> <span class="ow">in</span> <span class="n">fileout</span><span class="p">:</span>
        <span class="n">linkage</span> <span class="o">=</span> <span class="s1">&#39;MSDOS&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># XXX the A.OUT format also falls under this class...</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">bits</span><span class="p">,</span> <span class="n">linkage</span>

<span class="c1">### Portable uname() interface</span>

<span class="n">uname_result</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;uname_result&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;system node release version machine processor&quot;</span><span class="p">)</span>

<span class="n">_uname_cache</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">uname</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Fairly portable uname interface. Returns a tuple</span>
<span class="sd">        of strings (system, node, release, version, machine, processor)</span>
<span class="sd">        identifying the underlying platform.</span>

<span class="sd">        Note that unlike the os.uname function this also returns</span>
<span class="sd">        possible processor information as an additional tuple entry.</span>

<span class="sd">        Entries which cannot be determined are set to &#39;&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_uname_cache</span>
    <span class="n">no_os_uname</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">_uname_cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_uname_cache</span>

    <span class="n">processor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Get some infos from the builtin os.uname API...</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">system</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">machine</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">no_os_uname</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">no_os_uname</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">machine</span><span class="p">))):</span>
        <span class="c1"># Hmm, no there is either no uname or uname has returned</span>
        <span class="c1">#&#39;unknowns&#39;... we&#39;ll have to poke around the system then.</span>
        <span class="k">if</span> <span class="n">no_os_uname</span><span class="p">:</span>
            <span class="n">system</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span>
            <span class="n">release</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">_node</span><span class="p">()</span>
            <span class="n">machine</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">use_syscmd_ver</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Try win32_ver() on win32 platforms</span>
        <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
            <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">ptype</span> <span class="o">=</span> <span class="n">win32_ver</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">release</span> <span class="ow">and</span> <span class="n">version</span><span class="p">:</span>
                <span class="n">use_syscmd_ver</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># Try to use the PROCESSOR_* environment variables</span>
            <span class="c1"># available on Win XP and later; see</span>
            <span class="c1"># http://support.microsoft.com/kb/888731 and</span>
            <span class="c1"># http://www.geocities.com/rick_lively/MANUALS/ENV/MSWIN/PROCESSI.HTM</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">machine</span><span class="p">:</span>
                <span class="c1"># WOW64 processes mask the native architecture</span>
                <span class="k">if</span> <span class="s2">&quot;PROCESSOR_ARCHITEW6432&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                    <span class="n">machine</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PROCESSOR_ARCHITEW6432&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">machine</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PROCESSOR_ARCHITECTURE&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">processor</span><span class="p">:</span>
                <span class="n">processor</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PROCESSOR_IDENTIFIER&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="p">)</span>

        <span class="c1"># Try the &#39;ver&#39; system command available on some</span>
        <span class="c1"># platforms</span>
        <span class="k">if</span> <span class="n">use_syscmd_ver</span><span class="p">:</span>
            <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">_syscmd_ver</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
            <span class="c1"># Normalize system to what win32_ver() normally returns</span>
            <span class="c1"># (_syscmd_ver() tends to return the vendor name as well)</span>
            <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Microsoft Windows&#39;</span><span class="p">:</span>
                <span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;Windows&#39;</span>
            <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Microsoft&#39;</span> <span class="ow">and</span> <span class="n">release</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
                <span class="c1"># Under Windows Vista and Windows Server 2008,</span>
                <span class="c1"># Microsoft changed the output of the ver command. The</span>
                <span class="c1"># release is no longer printed.  This causes the</span>
                <span class="c1"># system and release to be misidentified.</span>
                <span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;Windows&#39;</span>
                <span class="k">if</span> <span class="s1">&#39;6.0&#39;</span> <span class="o">==</span> <span class="n">version</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="s1">&#39;Vista&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">release</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># In case we still don&#39;t know anything useful, we&#39;ll try to</span>
        <span class="c1"># help ourselves</span>
        <span class="k">if</span> <span class="n">system</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;win32&#39;</span><span class="p">,</span> <span class="s1">&#39;win16&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;32bit&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;16bit&#39;</span>
            <span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;Windows&#39;</span>

        <span class="k">elif</span> <span class="n">system</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;java&#39;</span><span class="p">:</span>
            <span class="n">release</span><span class="p">,</span> <span class="n">vendor</span><span class="p">,</span> <span class="n">vminfo</span><span class="p">,</span> <span class="n">osinfo</span> <span class="o">=</span> <span class="n">java_ver</span><span class="p">()</span>
            <span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;Java&#39;</span>
            <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vminfo</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">version</span><span class="p">:</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">vendor</span>

    <span class="c1"># System specific extensions</span>
    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;OpenVMS&#39;</span><span class="p">:</span>
        <span class="c1"># OpenVMS seems to have release and version mixed up</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">release</span> <span class="ow">or</span> <span class="n">release</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">release</span> <span class="o">=</span> <span class="n">version</span>
            <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># Get processor information</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">vms_lib</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">csid</span><span class="p">,</span> <span class="n">cpu_number</span> <span class="o">=</span> <span class="n">vms_lib</span><span class="o">.</span><span class="n">getsyi</span><span class="p">(</span><span class="s1">&#39;SYI$_CPU&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cpu_number</span> <span class="o">&gt;=</span> <span class="mi">128</span><span class="p">):</span>
                <span class="n">processor</span> <span class="o">=</span> <span class="s1">&#39;Alpha&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">processor</span> <span class="o">=</span> <span class="s1">&#39;VAX&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">processor</span><span class="p">:</span>
        <span class="c1"># Get processor information from the uname system command</span>
        <span class="n">processor</span> <span class="o">=</span> <span class="n">_syscmd_uname</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1">#If any unknowns still exist, replace them with &#39;&#39;s, which are more portable</span>
    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">release</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">release</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">machine</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">machine</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">processor</span> <span class="o">==</span> <span class="s1">&#39;unknown&#39;</span><span class="p">:</span>
        <span class="n">processor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1">#  normalize name</span>
    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Microsoft&#39;</span> <span class="ow">and</span> <span class="n">release</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
        <span class="n">system</span> <span class="o">=</span> <span class="s1">&#39;Windows&#39;</span>
        <span class="n">release</span> <span class="o">=</span> <span class="s1">&#39;Vista&#39;</span>

    <span class="n">_uname_cache</span> <span class="o">=</span> <span class="n">uname_result</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span>
                                <span class="n">machine</span><span class="p">,</span> <span class="n">processor</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_uname_cache</span>

<span class="c1">### Direct interfaces to some of the uname() return values</span>

<span class="k">def</span> <span class="nf">system</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the system/OS name, e.g. &#39;Linux&#39;, &#39;Windows&#39; or &#39;Java&#39;.</span>

<span class="sd">        An empty string is returned if the value cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">system</span>

<span class="k">def</span> <span class="nf">node</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the computer&#39;s network name (which may not be fully</span>
<span class="sd">        qualified)</span>

<span class="sd">        An empty string is returned if the value cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">node</span>

<span class="k">def</span> <span class="nf">release</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the system&#39;s release, e.g. &#39;2.2.0&#39; or &#39;NT&#39;</span>

<span class="sd">        An empty string is returned if the value cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">release</span>

<span class="k">def</span> <span class="nf">version</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the system&#39;s release version, e.g. &#39;#3 on degas&#39;</span>

<span class="sd">        An empty string is returned if the value cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">version</span>

<span class="k">def</span> <span class="nf">machine</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the machine type, e.g. &#39;i386&#39;</span>

<span class="sd">        An empty string is returned if the value cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">machine</span>

<span class="k">def</span> <span class="nf">processor</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the (true) processor name, e.g. &#39;amdk6&#39;</span>

<span class="sd">        An empty string is returned if the value cannot be</span>
<span class="sd">        determined. Note that many platforms do not provide this</span>
<span class="sd">        information or simply return the same value as for machine(),</span>
<span class="sd">        e.g.  NetBSD does this.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">uname</span><span class="p">()</span><span class="o">.</span><span class="n">processor</span>

<span class="c1">### Various APIs for extracting information from sys.version</span>

<span class="n">_sys_version_parser</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;([\w.+]+)\s*&#39;</span>  <span class="c1"># &quot;version&lt;space&gt;&quot;</span>
    <span class="sa">r</span><span class="s1">&#39;(?:\|[^|]*\|)?\s*&#39;</span> <span class="c1"># version extra</span>
    <span class="sa">r</span><span class="s1">&#39;\(#?([^,]+)&#39;</span>  <span class="c1"># &quot;(#buildno&quot;</span>
    <span class="sa">r</span><span class="s1">&#39;(?:,\s*([\w ]*)&#39;</span>  <span class="c1"># &quot;, builddate&quot;</span>
    <span class="sa">r</span><span class="s1">&#39;(?:,\s*([\w :]*))?)?\)\s*&#39;</span>  <span class="c1"># &quot;, buildtime)&lt;space&gt;&quot;</span>
    <span class="sa">r</span><span class="s1">&#39;\[([^\]]+)\]?&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>  <span class="c1"># &quot;[compiler]&quot;</span>

<span class="n">_ironpython_sys_version_parser</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;IronPython\s*&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;([\d\.]+)&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(?: \(([\d\.]+)\))?&#39;</span>
    <span class="sa">r</span><span class="s1">&#39; on (.NET [\d\.]+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">ASCII</span><span class="p">)</span>

<span class="c1"># IronPython covering 2.6 and 2.7</span>
<span class="n">_ironpython26_sys_version_parser</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;([\d.]+)\s*&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;\(IronPython\s*&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;[\d.]+\s*&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;\(([\d.]+)\) on ([\w.]+ [\d.]+(?: \(\d+-bit\))?)\)&#39;</span>
<span class="p">)</span>

<span class="n">_pypy_sys_version_parser</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;([\w.+]+)\s*&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;\(#?([^,]+),\s*([\w ]+),\s*([\w :]+)\)\s*&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;\[PyPy [^\]]+\]?&#39;</span><span class="p">)</span>

<span class="n">_sys_version_cache</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">_sys_version</span><span class="p">(</span><span class="n">sys_version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Returns a parsed version of Python&#39;s sys.version as tuple</span>
<span class="sd">        (name, version, branch, revision, buildno, builddate, compiler)</span>
<span class="sd">        referring to the Python implementation name, version, branch,</span>
<span class="sd">        revision, build number, build date/time as string and the compiler</span>
<span class="sd">        identification string.</span>

<span class="sd">        Note that unlike the Python sys.version, the returned value</span>
<span class="sd">        for the Python version will always include the patchlevel (it</span>
<span class="sd">        defaults to &#39;.0&#39;).</span>

<span class="sd">        The function returns empty strings for tuple entries that</span>
<span class="sd">        cannot be determined.</span>

<span class="sd">        sys_version may be given to parse an alternative version</span>
<span class="sd">        string, e.g. if the version was read from a different Python</span>
<span class="sd">        interpreter.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the Python version</span>
    <span class="k">if</span> <span class="n">sys_version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sys_version</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span>

    <span class="c1"># Try the cache first</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">_sys_version_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sys_version</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># Parse it</span>
    <span class="k">if</span> <span class="s1">&#39;IronPython&#39;</span> <span class="ow">in</span> <span class="n">sys_version</span><span class="p">:</span>
        <span class="c1"># IronPython</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;IronPython&#39;</span>
        <span class="k">if</span> <span class="n">sys_version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;IronPython&#39;</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">_ironpython_sys_version_parser</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sys_version</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">_ironpython26_sys_version_parser</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sys_version</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;failed to parse IronPython sys.version: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                <span class="nb">repr</span><span class="p">(</span><span class="n">sys_version</span><span class="p">))</span>

        <span class="n">version</span><span class="p">,</span> <span class="n">alt_version</span><span class="p">,</span> <span class="n">compiler</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">buildno</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">builddate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;java&#39;</span><span class="p">):</span>
        <span class="c1"># Jython</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Jython&#39;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">_sys_version_parser</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sys_version</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;failed to parse Jython sys.version: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                <span class="nb">repr</span><span class="p">(</span><span class="n">sys_version</span><span class="p">))</span>
        <span class="n">version</span><span class="p">,</span> <span class="n">buildno</span><span class="p">,</span> <span class="n">builddate</span><span class="p">,</span> <span class="n">buildtime</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">builddate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">builddate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span>

    <span class="k">elif</span> <span class="s2">&quot;PyPy&quot;</span> <span class="ow">in</span> <span class="n">sys_version</span><span class="p">:</span>
        <span class="c1"># PyPy</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;PyPy&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">_pypy_sys_version_parser</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sys_version</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;failed to parse PyPy sys.version: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                             <span class="nb">repr</span><span class="p">(</span><span class="n">sys_version</span><span class="p">))</span>
        <span class="n">version</span><span class="p">,</span> <span class="n">buildno</span><span class="p">,</span> <span class="n">builddate</span><span class="p">,</span> <span class="n">buildtime</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># CPython</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">_sys_version_parser</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sys_version</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;failed to parse CPython sys.version: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                <span class="nb">repr</span><span class="p">(</span><span class="n">sys_version</span><span class="p">))</span>
        <span class="n">version</span><span class="p">,</span> <span class="n">buildno</span><span class="p">,</span> <span class="n">builddate</span><span class="p">,</span> <span class="n">buildtime</span><span class="p">,</span> <span class="n">compiler</span> <span class="o">=</span> \
              <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;CPython&#39;</span>
        <span class="k">if</span> <span class="n">builddate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">builddate</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">buildtime</span><span class="p">:</span>
            <span class="n">builddate</span> <span class="o">=</span> <span class="n">builddate</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">buildtime</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;_git&#39;</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">revision</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_git</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;_mercurial&#39;</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">revision</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_mercurial</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">branch</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">revision</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Add the patchlevel version if missing</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

    <span class="c1"># Build and cache the result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">branch</span><span class="p">,</span> <span class="n">revision</span><span class="p">,</span> <span class="n">buildno</span><span class="p">,</span> <span class="n">builddate</span><span class="p">,</span> <span class="n">compiler</span><span class="p">)</span>
    <span class="n">_sys_version_cache</span><span class="p">[</span><span class="n">sys_version</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">python_implementation</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns a string identifying the Python implementation.</span>

<span class="sd">        Currently, the following implementations are identified:</span>
<span class="sd">          &#39;CPython&#39; (C implementation of Python),</span>
<span class="sd">          &#39;IronPython&#39; (.NET implementation of Python),</span>
<span class="sd">          &#39;Jython&#39; (Java implementation of Python),</span>
<span class="sd">          &#39;PyPy&#39; (Python implementation of Python).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">python_version</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the Python version as string &#39;major.minor.patchlevel&#39;</span>

<span class="sd">        Note that unlike the Python sys.version, the returned value</span>
<span class="sd">        will always include the patchlevel (it defaults to 0).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">python_version_tuple</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns the Python version as tuple (major, minor, patchlevel)</span>
<span class="sd">        of strings.</span>

<span class="sd">        Note that unlike the Python sys.version, the returned value</span>
<span class="sd">        will always include the patchlevel (it defaults to 0).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_sys_version</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">python_branch</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns a string identifying the Python implementation</span>
<span class="sd">        branch.</span>

<span class="sd">        For CPython this is the SCM branch from which the</span>
<span class="sd">        Python binary was built.</span>

<span class="sd">        If not available, an empty string is returned.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">python_revision</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns a string identifying the Python implementation</span>
<span class="sd">        revision.</span>

<span class="sd">        For CPython this is the SCM revision from which the</span>
<span class="sd">        Python binary was built.</span>

<span class="sd">        If not available, an empty string is returned.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">python_build</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns a tuple (buildno, builddate) stating the Python</span>
<span class="sd">        build number and date as strings.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">python_compiler</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot; Returns a string identifying the compiler used for compiling</span>
<span class="sd">        Python.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_sys_version</span><span class="p">()[</span><span class="mi">6</span><span class="p">]</span>

<span class="c1">### The Opus Magnum of platform strings :-)</span>

<span class="n">_platform_cache</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="platform"><a class="viewcode-back" href="../jtyoui.html#jtyoui.platform">[文档]</a><span class="k">def</span> <span class="nf">platform</span><span class="p">(</span><span class="n">aliased</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">terse</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; Returns a single string identifying the underlying platform</span>
<span class="sd">        with as much useful information as possible (but no more :).</span>

<span class="sd">        The output is intended to be human readable rather than</span>
<span class="sd">        machine parseable. It may look different on different</span>
<span class="sd">        platforms and this is intended.</span>

<span class="sd">        If &quot;aliased&quot; is true, the function will use aliases for</span>
<span class="sd">        various platforms that report system names which differ from</span>
<span class="sd">        their common names, e.g. SunOS will be reported as</span>
<span class="sd">        Solaris. The system_alias() function is used to implement</span>
<span class="sd">        this.</span>

<span class="sd">        Setting terse to true causes the function to return only the</span>
<span class="sd">        absolute minimum information needed to identify the platform.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">_platform_cache</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">aliased</span><span class="p">,</span> <span class="n">terse</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># Get uname information and then apply platform specific cosmetics</span>
    <span class="c1"># to it...</span>
    <span class="n">system</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">processor</span> <span class="o">=</span> <span class="n">uname</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">machine</span> <span class="o">==</span> <span class="n">processor</span><span class="p">:</span>
        <span class="n">processor</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">aliased</span><span class="p">:</span>
        <span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="n">system_alias</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
        <span class="c1"># MS platforms</span>
        <span class="n">rel</span><span class="p">,</span> <span class="n">vers</span><span class="p">,</span> <span class="n">csd</span><span class="p">,</span> <span class="n">ptype</span> <span class="o">=</span> <span class="n">win32_ver</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">terse</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">csd</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">system</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Linux&#39;</span><span class="p">,):</span>
        <span class="c1"># Linux based systems</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="c1"># see issue #1322 for more information</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
                <span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                <span class="sa">r</span><span class="s1">&#39;dist\(\) and linux_distribution\(\) &#39;</span>
                <span class="s1">&#39;functions are deprecated .*&#39;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">distname</span><span class="p">,</span> <span class="n">distversion</span><span class="p">,</span> <span class="n">distid</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">distname</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">terse</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">processor</span><span class="p">,</span>
                                 <span class="s1">&#39;with&#39;</span><span class="p">,</span>
                                 <span class="n">distname</span><span class="p">,</span> <span class="n">distversion</span><span class="p">,</span> <span class="n">distid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the distribution name is unknown check for libc vs. glibc</span>
            <span class="n">libcname</span><span class="p">,</span> <span class="n">libcversion</span> <span class="o">=</span> <span class="n">libc_ver</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">)</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">processor</span><span class="p">,</span>
                                 <span class="s1">&#39;with&#39;</span><span class="p">,</span>
                                 <span class="n">libcname</span><span class="o">+</span><span class="n">libcversion</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;Java&#39;</span><span class="p">:</span>
        <span class="c1"># Java platforms</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">vminfo</span><span class="p">,</span> <span class="p">(</span><span class="n">os_name</span><span class="p">,</span> <span class="n">os_version</span><span class="p">,</span> <span class="n">os_arch</span><span class="p">)</span> <span class="o">=</span> <span class="n">java_ver</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">terse</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os_name</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span>
                                 <span class="s1">&#39;on&#39;</span><span class="p">,</span>
                                 <span class="n">os_name</span><span class="p">,</span> <span class="n">os_version</span><span class="p">,</span> <span class="n">os_arch</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s1">&#39;MacOS&#39;</span><span class="p">:</span>
        <span class="c1"># MacOS platforms</span>
        <span class="k">if</span> <span class="n">terse</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">machine</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Generic handler</span>
        <span class="k">if</span> <span class="n">terse</span><span class="p">:</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bits</span><span class="p">,</span> <span class="n">linkage</span> <span class="o">=</span> <span class="n">architecture</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">)</span>
            <span class="n">platform</span> <span class="o">=</span> <span class="n">_platform</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">release</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span>
                                 <span class="n">processor</span><span class="p">,</span> <span class="n">bits</span><span class="p">,</span> <span class="n">linkage</span><span class="p">)</span>

    <span class="n">_platform_cache</span><span class="p">[(</span><span class="n">aliased</span><span class="p">,</span> <span class="n">terse</span><span class="p">)]</span> <span class="o">=</span> <span class="n">platform</span>
    <span class="k">return</span> <span class="n">platform</span></div>

<span class="c1">### Command line interface</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Default is to print the aliased verbose platform string</span>
    <span class="n">terse</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;terse&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">or</span> <span class="s1">&#39;--terse&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">aliased</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;nonaliased&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;--nonaliased&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">platform</span><span class="p">(</span><span class="n">aliased</span><span class="p">,</span> <span class="n">terse</span><span class="p">))</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, 张伟

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>